<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Monitoring Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* Theme Variables */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111;
            --bg-tertiary: #1a1a1a;
            --bg-quaternary: #151515;
            --border-primary: #333;
            --border-secondary: #222;
            --text-primary: #ccc;
            --text-secondary: #aaa;
            --text-tertiary: #999;
            --text-accent: #fff;
            --accent-green: #4a9;
            --accent-red: #a44;
            --accent-orange: #c96;
            --accent-blue: #69c;
            --accent-teal: #6c9;
            --shadow: rgba(0, 0, 0, 0.6);
        }

        [data-theme="light"] {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e9ecef;
            --bg-quaternary: #dee2e6;
            --border-primary: #ced4da;
            --border-secondary: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #495057;
            --text-tertiary: #6c757d;
            --text-accent: #000000;
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --accent-orange: #fd7e14;
            --accent-blue: #007bff;
            --accent-teal: #20c997;
            --shadow: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
            font-weight: 500;
            display: flex;
            transition: all 0.3s ease;
        }

        /* Subtle background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 98%, var(--border-secondary) 100%),
                linear-gradient(0deg, transparent 98%, var(--border-secondary) 100%);
            background-size: 60px 60px;
            z-index: -1;
            opacity: 0.3;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: absolute;
            bottom: 20px;
            left: 20px;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.2em;
            z-index: 1001;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-primary);
            box-shadow: 0 2px 8px var(--shadow);
        }

        .theme-toggle:hover {
            background: var(--bg-quaternary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
/* Navigation Sidebar */
        .nav-sidebar {
            width: 250px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: all 0.3s ease;
            box-shadow: 2px 0 10px var(--shadow);
        }

        .nav-header {
            background: var(--bg-tertiary);
            padding: 20px;
            border-bottom: 1px solid var(--border-primary);
            text-align: center;
        }

        .nav-header h1 {
            color: var(--text-accent);
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .nav-header p {
            color: var(--text-secondary);
            font-size: 0.8em;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 25px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9em;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-left-color: var(--accent-green);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--accent-green);
            border-left-color: var(--accent-green);
        }

        /* Main Content Area */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
            min-height: 100vh;
            position: relative;
        }

        /* Dashboard Page */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .dashboard-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-primary);
            overflow: hidden;
        }

        .header {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid var(--border-primary);
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 2px;
            color: var(--text-accent);
        }

        .header p {
            font-size: 0.9em;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: var(--bg-quaternary);
            border-bottom: 1px solid var(--border-primary);
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9em;
            border: 1px solid;
            background: var(--bg-primary);
            font-weight: 500;
        }

        .status-active {
            color: var(--accent-green);
            border-color: var(--accent-green);
        }

        .status-inactive {
            color: var(--accent-red);
            border-color: var(--accent-red);
        }

        .pulse {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: 1px solid;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            background: var(--bg-primary);
            font-family: inherit;
            font-weight: 500;
        }

        .btn-start {
            color: var(--accent-green);
            border-color: var(--accent-green);
        }

        .btn-start:hover {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .btn-stop {
            color: var(--accent-red);
            border-color: var(--accent-red);
        }

        .btn-stop:hover {
            background: var(--accent-red);
            color: var(--bg-primary);
        }
        .content {
            padding: 25px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid var(--border-primary);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--border-primary);
            background: var(--bg-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--shadow);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .stat-total .stat-number { color: var(--accent-blue); }
        .stat-high .stat-number { color: var(--accent-red); }
        .stat-medium .stat-number { color: var(--accent-orange); }
        .stat-low .stat-number { color: var(--accent-teal); }

        .table-container {
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid var(--border-primary);
        }

        .table-header {
            background: var(--bg-secondary);
            color: var(--text-accent);
            padding: 15px 20px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-primary);
        }

        th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        td {
            font-weight: 500;
        }

        tr:hover {
            background: var(--bg-secondary);
        }

        .priority-high {
            background: var(--accent-red);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .priority-medium {
            background: var(--accent-orange);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .priority-low {
            background: var(--accent-teal);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .no-data {
            text-align: center;
            padding: 30px;
            color: var(--text-tertiary);
            font-style: italic;
        }

        .timestamp {
            color: var(--text-tertiary);
            font-size: 0.8em;
            font-weight: 500;
        }

        .connection-status {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.75em;
            z-index: 999;
            border: 1px solid;
            background: var(--bg-primary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .connected {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .disconnected {
            border-color: var(--accent-red);
            color: var(--accent-red);
        }

        .kill-btn {
            background: var(--accent-red);
            color: var(--bg-primary);
            border: 1px solid var(--accent-red);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-family: inherit;
            font-weight: 500;
        }

        .kill-btn:hover {
            background: var(--bg-primary);
            color: var(--accent-red);
        }

        /* FAQ and Manual Pages */
        .docs-content {
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-primary);
            padding: 30px;
            max-width: 800px;
        }

        .docs-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-primary);
        }

        .docs-header h1 {
            color: var(--text-accent);
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .docs-header p {
            color: var(--text-secondary);
            font-size: 1em;
        }.section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-secondary);
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: var(--text-accent);
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1em;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-content {
            color: var(--text-secondary);
            line-height: 1.6;
            display: none;
        }

        .section-content.show {
            display: block;
            margin-top: 10px;
        }

        .priority-example {
            background: var(--bg-tertiary);
            padding: 10px;
            border-radius: 4px;
            margin: 8px 0;
            border-left: 3px solid;
        }

        .priority-high-example { border-left-color: var(--accent-red); }
        .priority-medium-example { border-left-color: var(--accent-orange); }
        .priority-low-example { border-left-color: var(--accent-teal); }

        .expand-icon {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .expand-icon.expanded {
            transform: rotate(90deg);
        }

        .warning-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .warning-content {
            background: var(--bg-tertiary);
            padding: 30px;
            border-radius: 4px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
            border: 1px solid var(--border-primary);
        }

        .warning-title {
            font-size: 1.2em;
            color: var(--text-accent);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .warning-message {
            color: var(--text-primary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .warning-btn {
            background: var(--accent-green);
            color: var(--bg-primary);
            border: 1px solid var(--accent-green);
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-weight: 500;
        }

        .warning-btn:hover {
            background: var(--bg-primary);
            color: var(--accent-green);
        }

        @media (max-width: 1200px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                max-height: 400px;
                margin-bottom: 20px;
            }
        }

        @media (max-width: 768px) {
            .nav-sidebar {
                transform: translateX(-100%);
            }
            
            .nav-sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                width: 100%;
            }
            
            .btn {
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <!-- Navigation Sidebar -->
    <nav class="nav-sidebar" id="navSidebar">
        <div class="nav-header">
            <h1>Security Monitor</h1>
            <p>Navigation Menu</p>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="showPage('dashboard')">Dashboard</div>
            <div class="nav-item" onclick="showPage('manual')">User Manual</div>
            <div class="nav-item" onclick="showPage('faq')">FAQ</div>
        </div>
        <div class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="dashboard-container">
                <div class="header">
                    <h1>SECURITY MONITOR</h1>
                    <p>Real-time threat detection system</p>
                </div>

                <div class="status-bar">
                    <div class="status-info">
                        <div class="status-indicator" id="statusIndicator">
                            <div class="pulse" id="pulse" style="display: none;"></div>
                            <span id="statusText">Inactive</span>
                        </div>
                        <div class="timestamp">Last scan: <span id="lastUpdate">Never</span></div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-start" onclick="startMonitoring()">Start</button>
                        <button class="btn btn-stop" onclick="stopMonitoring()">Stop</button>
                    </div>
                </div>

                <div class="content">
                    <div class="stats-grid">
                        <div class="stat-card stat-total">
                            <div class="stat-number" id="totalThreats">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-card stat-high">
                            <div class="stat-number" id="highPriority">0</div>
                            <div class="stat-label">High</div>
                        </div>
                        <div class="stat-card stat-medium">
                            <div class="stat-number" id="mediumPriority">0</div>
                            <div class="stat-label">Medium</div>
                        </div>
                        <div class="stat-card stat-low">
                            <div class="stat-number" id="lowPriority">0</div>
                            <div class="stat-label">Low</div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            Detected Threats
                        </div>
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th>PID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Priority</th>
                                    <th>Access</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <tr>
                                    <td colspan="6" class="no-data">
                                        No threats detected. Click Start to begin monitoring.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Manual Page -->
        <div id="manual" class="page">
            <div class="docs-content">
                <div class="docs-header">
                    <h1>User Manual</h1>
                    <p>Complete guide to using the Security Monitoring System</p>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        System Overview <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        This system monitors active processes to detect potential security threats including keyloggers, microphone access, Bluetooth hijacking, and suspicious background activities. It provides real-time scanning with automatic threat classification.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Threat Priority Levels <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        <div class="priority-example priority-high-example">
                            <strong>HIGH:</strong> Direct data theft threats (keyloggers, credential stealers) - Requires immediate attention
                        </div>
                        <div class="priority-example priority-medium-example">
                            <strong>MEDIUM:</strong> Hardware access (microphone, Bluetooth, camera) - Monitor regularly
                        </div>
                        <div class="priority-example priority-low-example">
                            <strong>LOW:</strong> Minimal threat, essential system operations
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Process ID (PID) Analysis <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        PIDs help determine when processes started:<br>
                        • Low PIDs (1-1000): System processes<br>
                        • Medium PIDs (1000-10000): User applications<br>
                        • High PIDs (10000+): Recently created processes<br><br>
                        <strong>Suspicious patterns:</strong> High-PID threats appearing after kernel workers may indicate coordinated attacks.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Access Column Explained <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Shows system resources being accessed:<br>
                        • <strong>Keyboard:</strong> Possible keylogger<br>
                        • <strong>Microphone:</strong> Audio surveillance<br>
                        • <strong>Bluetooth:</strong> Data exfiltration<br>
                        • <strong>Camera:</strong> Visual surveillance
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Dashboard Controls <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        • <strong>Start Button:</strong> Begins real-time monitoring every 10 seconds<br>
                        • <strong>Stop Button:</strong> Halts monitoring process<br>
                        • <strong>Kill Button:</strong> Terminates suspicious processes<br>
                        • <strong>Statistics Cards:</strong> Show threat counts by priority level
                    </div>
                </div>
            </div>
        </div>

        <!-- FAQ Page -->
        <div id="faq" class="page">
            <div class="docs-content">
                <div class="docs-header">
                    <h1>Frequently Asked Questions</h1>
                    <p>Common questions and answers about the security system</p>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        What does this system detect? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        The system detects keyloggers, microphone access, Bluetooth hijacking, camera access, and unusual background activities that could indicate security threats.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        How often does it scan? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        The system scans all active processes every 10 seconds when monitoring is active, providing real-time threat detection.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Are legitimate processes flagged? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Yes, some legitimate processes may be flagged (like gnome-keyring-daemon or pulseaudio). Use the safe processes file to exclude known safe applications.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        What are kworker processes? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Kernel worker threads that handle system tasks. Multiple high-PID kworkers appearing suddenly may indicate system stress from malicious activity.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Is it safe to kill processes? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Only kill processes you're certain are malicious. System processes should not be terminated. When in doubt, research the process name first.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        Why do I see multiple keyloggers? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Multiple instances may indicate: script restarting, coordinated attack, or the same malicious code running multiple times. This requires immediate attention.
                    </div>
                </div>

                <div class="section">
                    <div class="section-title" onclick="toggleSection(this)">
                        What if I can't connect? <span class="expand-icon">▶</span>
                    </div>
                    <div class="section-content">
                        Ensure the Python server is running in terminal and the virtual environment is activated. Check that port 5000 is not blocked by firewall.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="warning-modal" id="warningModal">
        <div class="warning-content">
            <div class="warning-title">Connection Required</div>
            <div class="warning-message">
                Server connection required to start monitoring. Please check your connection and try again.
            </div>
            <button class="warning-btn" onclick="closeWarning()">OK</button>
        </div>
    </div>

    <script>
        const socket = io();
        let isMonitoring = false;
        let isConnected = false;

        // Theme functionality
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            const themeToggle = document.getElementById('themeToggle');
            
            document.documentElement.setAttribute('data-theme', newTheme);
            
            if (newTheme === 'light') {
                themeToggle.textContent = '☀️';
            } else {
                themeToggle.textContent = '🌙';
            }
            
            localStorage.setItem('theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const themeToggle = document.getElementById('themeToggle');
            
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            if (savedTheme === 'light') {
                themeToggle.textContent = '☀️';
            } else {
                themeToggle.textContent = '🌙';
            }
        }

        document.addEventListener('DOMContentLoaded', loadTheme);

        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(pageName).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleSection(element) {
            const content = element.nextElementSibling;
            const icon = element.querySelector('.expand-icon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.classList.remove('expanded');
            } else {
                content.classList.add('show');
                icon.classList.add('expanded');
            }
        }

        socket.on('connect', function() {
            isConnected = true;
            document.getElementById('connectionStatus').textContent = 'Connected';
            document.getElementById('connectionStatus').className = 'connection-status connected';
        });

        socket.on('disconnect', function() {
            isConnected = false;
            isMonitoring = false;
            updateStatusIndicator();
            document.getElementById('connectionStatus').textContent = 'Disconnected';
            document.getElementById('connectionStatus').className = 'connection-status disconnected';
        });

        socket.on('update_data', function(data) {
            updateTable(data.detections);
            updateStats(data.detections);
            updateTimestamp(data.timestamp);
        });

        function updateTable(detections) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (detections.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">No threats detected - System clean</td></tr>';
                return;
            }

            detections.forEach(detection => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${detection.PID}</td>
                    <td>${detection.Name}</td>
                    <td>${detection.Type}</td>
                    <td><span class="priority-${detection.Priority.toLowerCase()}">${detection.Priority}</span></td>
                    <td>${detection['Sensor Access']}</td>
                    <td><button class="kill-btn" onclick="killProcess(${detection.PID})">Kill</button></td>
                `;
            });
        }

        function updateStats(detections) {
            const total = detections.length;
            const high = detections.filter(d => d.Priority === 'High').length;
            const medium = detections.filter(d => d.Priority === 'Medium').length;
            const low = detections.filter(d => d.Priority === 'Low').length;

            document.getElementById('totalThreats').textContent = total;
            document.getElementById('highPriority').textContent = high;
            document.getElementById('mediumPriority').textContent = medium;
            document.getElementById('lowPriority').textContent = low;
        }

        function updateTimestamp(timestamp) {
            document.getElementById('lastUpdate').textContent = timestamp;
        }

        function startMonitoring() {
            if (!isConnected) {
                showWarning();
                return;
            }

            fetch('/start_monitoring', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started' || data.status === 'already_running') {
                    isMonitoring = true;
                    updateStatusIndicator();
                }
            })
            .catch(error => {
                console.error('Error starting monitoring:', error);
                showWarning();
            });
        }

        function showWarning() {
            document.getElementById('warningModal').style.display = 'flex';
        }

        function closeWarning() {
            document.getElementById('warningModal').style.display = 'none';
        }

        function stopMonitoring() {
            fetch('/stop_monitoring', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'stopped') {
                    isMonitoring = false;
                    updateStatusIndicator();
                }
            });
        }

        function killProcess(pid) {
            if (!isConnected) {
                showWarning();
                return;
            }

            if (confirm(`Kill process ${pid}?`)) {
                fetch('/kill_process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({pid: pid})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'killed') {
                        alert(`Process ${pid} terminated`);
                    } else {
                        alert(`Failed to kill process: ${data.message}`);
                    }
                })
                .catch(error => {
                    console.error('Error killing process:', error);
                    showWarning();
                });
            }
        }

        function updateStatusIndicator() {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const pulse = document.getElementById('pulse');

            if (isMonitoring) {
                indicator.className = 'status-indicator status-active';
                statusText.textContent = 'Active';
                pulse.style.display = 'block';
            } else {
                indicator.className = 'status-indicator status-inactive';
                statusText.textContent = 'Inactive';
                pulse.style.display = 'none';
            }
        }
    </script>
</body>
</html>